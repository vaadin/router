<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-router-core tests</title>
  <script src="../../../web-component-tester/browser.js"></script>
  <script src="../../dist/test-iife/triggers/triggerNavigation.js"></script>
  <script src="../../dist/test-iife/triggers/click.js"></script>
</head>

<body>
  <div>
    <a id="in-app-relative" href="in-app/url">in-app (relative)</a>
    <a id="in-app-relative-dot" href="./in-app/url">in-app (relative, starts with a dot slash `./`)</a>
    <a id="in-app-absolute" href="set-at-the-run-time">in-app (absolute)</a>
    <a id="in-app-target-blank" target="_blank" href="in-app/url">in-app with a blank target</a>
    <a id="external-relative" href="/">external (relative)</a>
    <a id="external-absolute" href="http://example.com">external (absolute)</a>
  </div>

  <script>
    (({CLICK}) => {
      describe('NavigationTriggers.CLICK', function() {
        this.title = this.title + (window.ShadyDOM ? ' (Shady DOM)' : '');

        const clicks = [];
        function onWindowClick(event) {
          clicks.push(event);
          event.preventDefault();
        }

        before(() => {
          window.addEventListener('click', onWindowClick)
        });

        after(() => {
          window.removeEventListener('click', onWindowClick)
        });

        beforeEach(() => {
          // clear the array
          clicks.length = 0;
        });

        it('should expose the NavigationTrigger API', () => {
          expect(CLICK).to.have.property('activate').that.is.a('function');
          expect(CLICK).to.have.property('inactivate').that.is.a('function');
        });

        it('should translate `click` events into `vaadin-router:navigate` when activated', () => {
          CLICK.inactivate();
          const spy = sinon.spy();
          window.addEventListener('vaadin-router:navigate', spy);
          CLICK.activate();
          document.getElementById('in-app-relative').click();
          window.removeEventListener('vaadin-router:navigate', spy);
          expect(spy).to.have.been.called.once;
          expect(spy.args[0][0]).to.have.property('type', 'vaadin-router:navigate');
          expect(spy.args[0][0]).to.have.deep.property('detail.pathname', 'in-app/url');
        });

        it('should not translate `click` events into `vaadin-router:navigate` when inactivated', () => {
          CLICK.activate();
          CLICK.inactivate();
          const spy = sinon.spy();
          window.addEventListener('vaadin-router:navigate', spy);
          document.getElementById('in-app-relative').click();
          window.removeEventListener('vaadin-router:navigate', spy);
          expect(spy).to.not.have.been.called;
        });
      });
    })(VaadinTestNamespace);
  </script>
</body>
