<!--
@license
Copyright (c) 2018 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<script>
(() => {
  window.Vaadin = window.Vaadin || {};

  /**
   * @polymerMixin
   */
  Vaadin.RouterMixin = superClass => class VaadinRouterMixin extends superClass {
    static get properties() {
      return {
        router: Object
      };
    }

    constructor() {
      super();
      this.__popstateListener = this._onPopstate.bind(this);
    }

    connectedCallback() {
      super.connectedCallback();
      
      this.router = {};
      this._onPopstate();
      window.addEventListener('popstate', this.__popstateListener);
    }

    disconnectedCallback() {
      window.removeEventListener('popstate', this.__popstateListener);
      super.disconnectedCallback();
    }

    _onPopstate(event) {
      if (this.set) {
        this.set('router.pathname', window.location.pathname)
      } else {
        this.router.pathname = window.location.pathname;
      }
    }
  };
})();
</script>
