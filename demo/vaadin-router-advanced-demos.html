<dom-module id="vaadin-router-advanced-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <p>Current demos cover advanced <code>Vaadin.Router</code> features.</p>
    <p>These features are not mandatory for every router use, but might be helpful in certain situations.</p>

    <h3>Async Route Resolution</h3>
    <p>Each route can have <code>action</code> method which is called before navigation to the path specified.</p>
    <p>This method can be used for complex navigation cases. If you need to simply open the page specified, use
      <code>component</code> instead.</p>
    <p>Note: For a single route, both <code>component</code> and <code>action</code> cannot be defined.</p>
    <p>Current example demonstrates the way you can perform async tasks on view enter</p>
    <vaadin-demo-snippet id="vaadin-router-advanced-demo-1" iframe-src="iframe.html">
      <template preserve-content>
        <nav>
          <vaadin-router-link href="/">Root (no delay on open)</vaadin-router-link>
          <vaadin-router-link href="/users">All Users (slight delay on open)</vaadin-router-link>
          <vaadin-router-link href="/users/kim">Kim (slight delay on open)</vaadin-router-link>
        </nav>
        <div id="outlet"></div>
        <script type="module">
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;

          const pollBackendForChanges = () => {
            return new Promise((resolve, reject) => {
              // this can be an async backend call
              setTimeout(() => resolve(), 1000);
            });
          };

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', component: 'x-home-view'},
            {
              path: '/users',
              action: pollBackendForChanges, // will be triggered for all children
              children: [
                {path: '/', component: 'x-user-list'},
                {path: '/:user', component: 'x-user-profile'}
              ]
            },
          ]);
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Custom Route Action</h3>
    <p><code>vaadin-router</code> provides an api for handling current route:
    <ul>
      <li>`context.pathname` property holding the current path string</li>
      <li>`context.next` method for navigating to the next route in the route's list (if any)</li>
      <li>`params` object that holds current route's parameters</li>
    </ul>
    </p>
    <p>Current example demonstrates the way to get visit statistics for each dedicated url.</p>
    <vaadin-demo-snippet id="vaadin-router-advanced-demo-2" iframe-src="iframe.html">
      <template preserve-content>
        <nav>
          <vaadin-router-link href="/">Root</vaadin-router-link>
          <vaadin-router-link href="/users">All Users</vaadin-router-link>
          <vaadin-router-link href="/users/kim">Kim</vaadin-router-link>
        </nav>
        <div id="stats"></div>
        <div id="outlet"></div>
        <script type="module">
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;
          const urlToNumberOfVisits = {};

          const recordUrlVisit = (context, params) => {
            const visitedPath = context.pathname; // get current path
            urlToNumberOfVisits[visitedPath] = (urlToNumberOfVisits[visitedPath] || 0) + 1;
            document.getElementById('stats').innerHTML =
              `Statistics on url visits: ${JSON.stringify(urlToNumberOfVisits, null, 2)}}`;
            return context.next(); // redirect to the next route in the list
          };

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', component: 'x-home-view'},
            {
              path: '/users',
              action: recordUrlVisit, // will be triggered for all children
              children: [
                {path: '/', component: 'x-user-list'},
                {path: '/:user', component: 'x-user-profile'}
              ]
            },
          ]);
        </script>
      </template>
    </vaadin-demo-snippet>
  </template>
  <script>
    class VaadinRouterAdvancedDemos extends DemoReadyEventEmitter(ElementDemo(Polymer.Element)) {
      static get is() {
        return 'vaadin-router-advanced-demos';
      }
    }

    customElements.define(VaadinRouterAdvancedDemos.is, VaadinRouterAdvancedDemos);
  </script>
</dom-module>
