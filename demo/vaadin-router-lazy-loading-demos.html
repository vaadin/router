<dom-module id="vaadin-router-lazy-loading-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <h3>Lazy Loading JS Bundles</h3>
    <p>
      Vaadin.Router has a special support for lazy loading <code>.js</code> and
      <code>.mjs</code> scripts just-in-time before rendering a route Web
      Component. In order to use this feature, specify the script URL in a
      <code>bundle</code> property of the route object.
    </p>
    <p>
      Note: If the bundle URL does not end with <code>.js</code> nor with <code>
      .mjs</code>, Vaadin.Router throws an <code>Error</code> and does not
      attempt to loaded the bundle. Use a custom route action as shown in the
      next demo if you need to load different types of the bundles.
    </p>
    <p>
      This demo shows how to load the <code>component-definition.js</code>
      script which defines the custom element for the <code>/lazy</code> route.
      Check the network tab in the browser DevTools to see that the script is
      loaded only after clickig at the <code>/lazy</code> route link.
    </p>
    <vaadin-demo-snippet id="vaadin-router-lazy-loading-1" iframe-src="iframe.html">
      <template preserve-content>
        <a href="/">Home</a>
        <a href="/lazy">Lazy load bundle</a>
        <div id="outlet"></div>
        <script type="module">
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', component: 'x-home-view'},
            {
              path: '/lazy',
              bundle: './demo-elements/component-definition.js',
              component: 'x-bundle-test-view' // <-- defined in the bundle
            },
          ]);
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Lazy Loading non-JS Bundles</h3>
    <p>
      In cases when loading <code>.js</code> and <code>.mjs</code> is not
      enough&mdash;most notably, when using HTML imports in Polymer-based
      apps&mdash;the lazy loading feature can be implemented with a custom route
      action (for more details see <a href="#vaadin-router-route-actions-demos">
      Route Actions</a>).
    </p>
    <p>
      This demo shows a way to lazily add an HTML import. The <code>
      component-definition.html</code> file contains entire Polymer 2 component
      definition including a template, a class, and a script that defines a
      custom element.
    </p>
    <vaadin-demo-snippet id="vaadin-router-lazy-loading-2" iframe-src="iframe.html">
      <template preserve-content>
        <a href="/">Home</a>
        <a href="/lazy">Lazy load custom bundle</a>
        <div id="outlet"></div>
        <script type="module">
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;

          const loadCustomBundle = () => {
            return new Promise((resolve, reject) => {
              // This is one way of loading a bundle lazily (works for Polymer apps).
              // Other apps might use different ways.
              Polymer.importHref(
                './demo-elements/component-definition.html', () => resolve(), reject, true);
            });
          };

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', component: 'x-home-view'},
            {path: '/lazy', action: loadCustomBundle},
            {path: '/lazy', component: 'x-bundle-custom-test'},
          ]);
        </script>
      </template>
    </vaadin-demo-snippet>
  </template>
  <script>
    class VaadinRouterLazyLoadingDemos extends DemoReadyEventEmitter(ElementDemo(Polymer.Element)) {
      static get is() {
        return 'vaadin-router-lazy-loading-demos';
      }
    }

    customElements.define(VaadinRouterLazyLoadingDemos.is, VaadinRouterLazyLoadingDemos);
  </script>
</dom-module>
