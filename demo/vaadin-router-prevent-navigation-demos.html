<dom-module id="vaadin-router-prevent-navigation-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <h3>Prevent Navigation Using <code>onBeforeLeave</code> Lifecycle Callback</h3>
    <p>
      The <code>onBeforeLeave</code> lifecycle callback on the component can be used to prevent navigation
      from it. In order to do this, the callback must return the <code>context.cancel()</code> result from the
      <code>context</code> parameter passed to the callback by Router.
    </p>
    <p>
      This feature is intended to protect the user from switching to the different URL without performing
      some needed actions while staying within current view. Note that the user is still able to copy and
      open that URL manually in the browser.
    </p>
    <vaadin-demo-snippet id="vaadin-router-prevent-navigation-demos-1" iframe-src="iframe.html">
      <template preserve-content>
        <dom-module id="x-user-manage">
          <template>
            <h1>Manage user</h1>
            <p>User name: [[route.params.user]]</p>
            <a href="/user/delete">Delete user</a>
          </template>
        </dom-module>
        <div id="outlet"></div>
        <script type="module">
          Polymer({
            is: 'x-user-manage',
            onBeforeLeave: function(context) {
              if (context.pathname.indexOf('user/delete') > 0) {
                return confirm('Are you sure you want to delete this user?') || context.cancel();
              }
            }
          });
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', redirect: '/user/guest/manage'},
            {path: '/user/:user/manage', component: 'x-user-manage'},
            {path: '/user/delete', component: 'x-user-deleted'}
          ]);

          Polymer({
            is: 'x-user-deleted',
            ready: function() {
              this.innerHTML = 'User has been deleted.';
            }
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Prevent Navigation Using <code>onBeforeEnter</code> Lifecycle Callback</h3>
    <p>
      The <code>onBeforeEnter</code> lifecycle callback on the component can also return
      the <code>context.cancel()</code> result, which will prevent navigation to it. Another option is to
      redirect the user from this callback, see <a href="#vaadin-router-redirect-demos">Redirect</a> section for examples.
    </p>
    <vaadin-demo-snippet id="vaadin-router-prevent-navigation-demos-2" iframe-src="iframe.html">
      <template preserve-content>
        <a href="/">Home</a>
        <a href="/danger">Danger</a>
        <div id="outlet"></div>
        <script type="module">
          Polymer({
            is: 'x-dangerous',
            onBeforeEnter: function(context) {
              if (!confirm('Do you really want to know it?')) {
                return context.cancel();
              }
            }
          });
          // import {Router} from '@vaadin/router';
          const {Router} = window.Vaadin;

          const router = new Router(document.getElementById('outlet'));
          router.setRoutes([
            {path: '/', component: 'x-home-view'},
            {path: '/danger', component: 'x-dangerous'}
          ]);
        </script>
        <dom-module id="x-dangerous">
          <template>
            <h1>Santa Claus Doesn't Exist</h1>
            <p>Sorry.</p>
          </template>
        </dom-module>
      </template>
    </vaadin-demo-snippet>

  </template>
  <script>
    class VaadinRouterPreventNavigationDemos extends DemoReadyEventEmitter(ElementDemo(Polymer.Element)) {
      static get is() {
        return 'vaadin-router-prevent-navigation-demos';
      }
    }
    customElements.define(VaadinRouterPreventNavigationDemos.is, VaadinRouterPreventNavigationDemos);
  </script>
</dom-module>
